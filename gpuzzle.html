<html>
<head>
<title>gpuzzle</title>
<link rel="icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABACAIAAADKyY23AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANvSURBVGhD7VlLcuowECSprJJKcpPkRDlCFhSbHIZilyNkadY5AdwiPoJeywJ7ZiSNJH8ow3NXL0DSNLRHI5thZa4fi4d5YPEwD4Q9fH+btzfz8GBWqzIiBIEIj2IC6YCHz0/z+ioViohwiAQwjbT0AJ8DP8URIvKSTSYtPSBdIqQ3IcUwmbT0kNyoh9NCi2ptNnuz9dY4QoqhRw3EyKWlB7GYcWcX1PtupKrtCJy0I4IMYm4gCbI9rA2+MDXgiDxcjYft0c7Gtk2MDGJuIAlyPdgyqM3GG9fJIOYkNzbRJxy8WY8E/T1gF3U4duOUDGKOsTGw33SvkzYI+ntox/0iackg5ih3kCFfel3Z9TuywCdBrgdXD3752g/fycGWDGKOco8rTy/81q4/pSVCglwP7mD1UzGOB5sHeuEbD6PnAWwLgJ5O43gQNYC01BWZDZGgwINjc8U6KMUAMog5SXIuJQ2ABMUeisgg5gaSYPGQIoOYG0iCxUOKDGJuIAlu0cNkP1Qu+BvoFn6L3kJPALj63owDfCJdPTYwQhAoM0AxgXTYw3Vh8TAP/E8efn/N15d5fzfPz+buzhIv8BaDmBqEwdJpDz8/J/37e3lUgBh0n4hlxRhJOuHh48O8vEjxILEMiwswnnTUw9+fvQSPj1JQ4dOTDUFgAmNLRz0ghGXY9TU4/FYNQhCYgJTOY1w67AGpC16mqu6aALGmNwK1zMekcxiRDnhACcU2KvXgOuHBLiXCw3WoSGcyJB3wgIyJwJbMg+vTRBrJ4bQr0vn0pKUHnMg40ERUy8w8gBCRh3tU+txZOm7tW9u3VFtMnrT0gBuLUm9+PcSafBCBFIMm3dhwHkC9z+dJSw96tt33bqF0KUGZc026xAPIpaUHZSOBoh50QopBky70wKWlBzytiPWURR4gxaBJF3rg0sUeYkXss8TDCrLn79007gHFhu4hmnB+n875c7FkL53/+7E4DN1Lek0XsaSmC6nXtH625rPwbC1h8mzV73H5hEj2Pa6QnrT0AIySc7mRHKaRDniY5sGswcWe+YAJHpDPuMyztwMy1qMCERLeRRRjS0c93MJvUQekLnMDY5m2hXyMJ53wAKCEcAlwoAXzj0FMYUG4iHWMJJ324IATGTcW94l4WgGdPgblfaAUg6VzPcwZi4c5wJh/Yxs6UnIh3hYAAAAASUVORK5CYII=">
<style>
.content {
	text-align: center;
	align-content: center;
}
.header {
        margin:auto;
	width:200px;
	text-align: center;
	align-content: center;
}

.middle {
        margin:auto;
        width:200px;
	text-align: center;
	align-content: center;
}

td div {
        width: 26px;
        height: 26px;
        text-align: center;
	align-content: center;
        vertical-align: middle;
        font-size: 21;
}

.rgb {
        width: 25px;
        height: 25px;
	border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border: 1px solid #00F;
        background-color: #00F;
        color:white;
}

.roy {
        width: 25px;
        height: 25px;
	border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border: 1px solid #FC0;
        background-color: #FC0;
        color:white;
}

.ror {
        width: 25px;
        height: 25px;
	border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border: 1px solid #F00;
        background-color: #F00;
        color:white;        
}

.rlg {
        width: 25px;
        height: 25px;
	border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border: 1px solid #0C0;
        background-color: #0C0;
        color:white;        
}

.rer {
        width: 25px;
        height: 25px;
	border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border: 1px solid #F00;
        background-color: #F00;
        color:white;        
}

.cgb {
        width: 25px;
        height: 25px;
	border-radius: 16px;
        -moz-border-radius: 16px;
        -webkit-border-radius: 16px;
        border: 1px solid #00F;
        background-color: #00F;
        color:white;        
}

.coy {
        width: 25px;
        height: 25px;
	border-radius: 16px;
        -moz-border-radius: 16px;
        -webkit-border-radius: 16px;
        border: 1px solid #FC0;
        background-color: #FC0;
        color:white;        
}

.cor {
        width: 25px;
        height: 25px;
	border-radius: 16px;
        -moz-border-radius: 16px;
        -webkit-border-radius: 16px;
        border: 1px solid #F00;
        background-color: #F00;
        color:white;        
}

.clg {
        width: 25px;
        height: 25px;
	border-radius: 16px;
        -moz-border-radius: 16px;
        -webkit-border-radius: 16px;
        border: 1px solid #0C0;
        background-color: #0C0;
        color:white;        
}

.cer {
        width: 25px;
        height: 25px;
	border-radius: 16px;
        -moz-border-radius: 16px;
        -webkit-border-radius: 16px;
        border: 1px solid #F00;
        background-color: #F00;
        color:white;        
}

.gray {
        width: 25px;
        height: 25px;
        background-color: #888;     
}

.empty {
        width: 5px;
        height: 5px;
        background-color:white;     
}
</style>
<script>

/*coordinates*/
var x=104;
var y=105;

/*rules*/
var aMove=false;
var bMove=false;
var lock = false;

/*combinations*/
var c=["rgb","roy","ror","rlg","rer"];
var d=["cgb","coy","cor","clg","cer"];
var e=["g" ,"o" ,"o" ,"l" ,"e"];

/*score*/
var score=0;

/*list of eliminations*/
var list = "-";
var checklist = "-";

function move(x1,x2,y1,y2) {
	if(document.getElementById(x2) == null || document.getElementById(y2) == null) {
		return false;
	}
	if((document.getElementById(x2).innerHTML == '' && document.getElementById(y2).innerHTML == '') || 
  	   (document.getElementById(x2).innerHTML == '' && y2 == x1) ||   
	   (document.getElementById(x2).innerHTML == '' && y1 == y2) || 
	   (document.getElementById(y2).innerHTML == '' && x2 == y1) || 
	   (document.getElementById(y2).innerHTML == '' && x1 == x2)) {
		var xClass = document.getElementById(x1).getAttribute("class");
		var xValue = document.getElementById(x1).innerHTML;
		var yClass = document.getElementById(y1).getAttribute("class");
		var yValue = document.getElementById(y1).innerHTML;
		empty(x1);
		empty(y1);
		document.getElementById(x2).setAttribute("class",xClass);
		document.getElementById(x2).innerHTML = xValue;
		document.getElementById(y2).setAttribute("class",yClass);
		document.getElementById(y2).innerHTML = yValue;
		return true;
	}
	return false;
}

function down() {
	down(false);
}

function down(s) {
	while(lock) {;}
	lock=true;
	if(move(x,x-10,y,y-10)) {
		x=x-10;y=y-10;
	} else {
		if(move(x,x-10,y,y)) {
			x=x-10;
			bMove=false;
		} else {
			aMove=false;
		}
		if(move(x,x,y,y-10)) {
			y=y-10;
			aMove=false;
		} else {
			bMove=false;
		}
	}
	lock=false;
	if(aMove || bMove) {
		if(s && !gameover()) {
			setTimeout(function(){down(true);},2000);
		}
	} else {
		if(!s && gameover()) {
			reset();
		}
		next();
	}
}

function left() {
	while(lock) {;}
	lock=true;
	if(aMove && bMove && move(x,x-1,y,y-1)) {
		x=x-1;y=y-1;
	}
	lock=false;
}

function right() {
	while(lock) {;}
	lock=true;
	if(aMove && bMove && move(x,x+1,y,y+1)) {
		x=x+1;y=y+1;
	}
	lock=false;
}

function rotate() {
	while(lock) {;}
	lock=true;
	if(aMove && bMove) {
		var rot = [-1,10,1,-10,-1];
		var d = x - y;
		var i = 0;
		for(i=0;i<rot.length;i++) {
			if(d == rot[i] && move(x,y+rot[i+1],y,y)) {
				x=y+rot[i+1];
			}
		}
	}
	lock=false;
}

function full(a) {
	var r = Math.floor((Math.random()*5));
	document.getElementById(a).innerHTML=e[r];
	var s = Math.floor((Math.random()*5));
	if(s==1 || s==3) {
		document.getElementById(a).setAttribute("class",d[r]);
	} else {
		document.getElementById(a).setAttribute("class",c[r]);
	}
}

function next() {
	if(gameover()) {
		return false;
	}
	evaluate();
	document.getElementById('score').innerHTML= "SCORE: " + score;
	x=103;y=104;aMove=true;bMove=true;
	if(document.getElementById("a").innerHTML== '' && document.getElementById("b").innerHTML == '') {
		full("a");
		full("b");
	}
	move("a",x,"b",y);
	full("a");
	full("b");
	setTimeout(function(){down(true);},2000);
	return true;
}

function reset() {
	if(!aMove && !bMove && gameover()) {
		for(var i=100;i>=0;i-=10){
			for(var j=0;j<8;j++) {
				empty(i+j);
			}
		}
		score=0;
		next();
	}
}

function gameover() {
	for(var i = 100; i < 108; i++) {
		if(getClass(i)!='' && getClass(i)!=null) {
			return true;
		}
	}
	return false;
}

function clean() {
	for(var i=100;i>=10;i-=10){
		for(var j=0;j<8;j++) {
			if(document.getElementById(i+j).getAttribute("class")!='' && document.getElementById(i+j-10).getAttribute("class")=='') {	
				document.getElementById(i+j-10).setAttribute("class",document.getElementById(i+j).getAttribute("class"));
				document.getElementById(i+j-10).innerHTML = document.getElementById(i+j).innerHTML;
				empty(i+j);
				i=100;j=0;
			}
		}
	}
}

function evaluate() {
	for(var i=100;i>=0;i-=10){
		for(var j=0;j<8;j++) {
			var clazz = document.getElementById(i+j).getAttribute("class");
			if(clazz!='' && "cgb,coy,cor,clg,cer".indexOf(clazz)!=-1) {
				list = "-";
				checklist = "-";
				if(eliminate(i+j,clazz.replace('c','r'))) {
					score+=10;
					i=100;j=0;
					clean();
				}
				list = "-";
				checklist = "-";
			}
			if(clazz!='' && "rgb"==clazz) {
				if(google(i+j)) {
					score +=100;
					i=100;j=0;
					clean();
				}
			}
		}
	}
}

function eliminate(a,b) {
	if(list.indexOf('-'+a+'-')!=-1) {
		return true;
	}
	if(checklist.indexOf('-'+a+'-')!=-1) {
		return false;
	}
	checklist += a + '-';
	if(document.getElementById(a)!=null && document.getElementById(a).getAttribute("class")!=null && document.getElementById(a).getAttribute("class").replace('c','r')==b) {
		list += a + '-';
		if(eliminate(a+10,b) | eliminate(a-10,b) | eliminate(a+1,b) | eliminate(a-1,b)) {
			empty(a);
			return true;
		}
	}
	return false;
}

function getClass(a) {
	if(document.getElementById(a)!=null) {
		return document.getElementById(a).getAttribute("class");
	}
	return '';
}

function empty(a) {
	document.getElementById(a).setAttribute("class",'');
	document.getElementById(a).innerHTML='';
}

function google(a) {
	var word="rgbrorroyrgbrlgrer";
	if(getClass(a)+getClass(a+1)+getClass(a+2)+getClass(a+3)+getClass(a+4)+getClass(a+5) == word) {
		empty(a);empty(a+1);empty(a+2);empty(a+3);empty(a+4);empty(a+5);return true;
	}
	if(getClass(a)+getClass(a-1)+getClass(a-2)+getClass(a-3)+getClass(a-4)+getClass(a-5) == word) {
		empty(a);empty(a-1);empty(a-2);empty(a-3);empty(a-4);empty(a-5);return true;
	}
	if(getClass(a)+getClass(a+10)+getClass(a+20)+getClass(a+30)+getClass(a+40)+getClass(a+50) == word) {
		empty(a);empty(a+10);empty(a+20);empty(a+30);empty(a+40);empty(a+50);return true;
	}
	if(getClass(a)+getClass(a-10)+getClass(a-20)+getClass(a-30)+getClass(a-40)+getClass(a-50) == word) {
		empty(a);empty(a-10);empty(a-20);empty(a-30);empty(a-40);empty(a-50);return true;
	}
	return false;
}

function keypress(e) {
	switch(e.keyCode) {
		case 37: left(); break; 
		case 39: right(); break; 
		case 40: down(); break; 
		case 38: rotate(); break; 
	}
	return false;
}

</script>
</head>
<body onload="document.onkeydown=keypress;">

<div class="content">

<div class="header">

<table style="border:0px;"><tr><td>

<table style="border:0px;">
<tr>
<td><div class="empty">&nbsp;</div></td>
<td><div class="rgb">G</div></td>
<td><div class="ror">o</div></td>
<td><div class="roy">o</div></td>
<td><div class="rgb">g</div></td>
<td><div class="rlg">l</div></td>
<td><div class="rer">e</div></td>
</tr>
<tr>
<td><div class="empty">&nbsp;</div></td>
<td><div class="cgb">P</div></td>
<td><div class="cor">u</div></td>
<td><div class="coy">z</div></td>
<td><div class="cgb">z</div></td>
<td><div class="clg">l</div></td>
<td><div class="cer">e</div></td>
</tr>
</table>

</td><td>

<table style ="border:1px solid black;"><tr><td>
<table style="border:0px;">
<tr>
<td><div id="a"></div></td>
</tr>
<tr>
<td><div id="b"></div></td>
</tr>
</table>
</td></tr></table>

</td></tr></table>
</div>

<div class="middle">
<table style ="border:0px;">
<tr><td></td><td>

<table style="border:1px solid black;">
<tr class="gray">
<td><div id="100"></div></td>
<td><div id="101"></div></td>
<td><div id="102"></div></td>
<td><div id="103"></div></td>
<td><div id="104"></div></td>
<td><div id="105"></div></td>
<td><div id="106"></div></td>
<td><div id="107"></div></td>
</tr>
<tr>
<td><div id="90"></div></td>
<td><div id="91"></div></td>
<td><div id="92"></div></td>
<td><div id="93"></div></td>
<td><div id="94"></div></td>
<td><div id="95"></div></td>
<td><div id="96"></div></td>
<td><div id="97"></div></td>
</tr>
<tr>
<td><div id="80"></div></td>
<td><div id="81"></div></td>
<td><div id="82"></div></td>
<td><div id="83"></div></td>
<td><div id="84"></div></td>
<td><div id="85"></div></td>
<td><div id="86"></div></td>
<td><div id="87"></div></td>
</tr>
<tr>
<td><div id="70"></div></td>
<td><div id="71"></div></td>
<td><div id="72"></div></td>
<td><div id="73"></div></td>
<td><div id="74"></div></td>
<td><div id="75"></div></td>
<td><div id="76"></div></td>
<td><div id="77"></div></td>
</tr>
<tr>
<td><div id="60"></div></td>
<td><div id="61"></div></td>
<td><div id="62"></div></td>
<td><div id="63"></div></td>
<td><div id="64"></div></td>
<td><div id="65"></div></td>
<td><div id="66"></div></td>
<td><div id="67"></div></td>
</tr>
<tr>
<td><div id="50"></div></td>
<td><div id="51"></div></td>
<td><div id="52"></div></td>
<td><div id="53"></div></td>
<td><div id="54"></div></td>
<td><div id="55"></div></td>
<td><div id="56"></div></td>
<td><div id="57"></div></td>
</tr>
<tr>
<td><div id="40"></div></td>
<td><div id="41"></div></td>
<td><div id="42"></div></td>
<td><div id="43"></div></td>
<td><div id="44"></div></td>
<td><div id="45"></div></td>
<td><div id="46"></div></td>
<td><div id="47"></div></td>
</tr>
<tr>
<td><div id="30"></div></td>
<td><div id="31"></div></td>
<td><div id="32"></div></td>
<td><div id="33"></div></td>
<td><div id="34"></div></td>
<td><div id="35"></div></td>
<td><div id="36"></div></td>
<td><div id="37"></div></td>
</tr>
<tr>
<td><div id="20"></div></td>
<td><div id="21"></div></td>
<td><div id="22"></div></td>
<td><div id="23"></div></td>
<td><div id="24"></div></td>
<td><div id="25"></div></td>
<td><div id="26"></div></td>
<td><div id="27"></div></td>
</tr>
<tr>
<td><div id="10"></div></td>
<td><div id="11"></div></td>
<td><div id="12"></div></td>
<td><div id="13"></div></td>
<td><div id="14"></div></td>
<td><div id="15"></div></td>
<td><div id="16"></div></td>
<td><div id="17"></div></td>
</tr>
<tr>
<td><div id="0"></div></td>
<td><div id="1"></div></td>
<td><div id="2"></div></td>
<td><div id="3"></div></td>
<td><div id="4"></div></td>
<td><div id="5"></div></td>
<td><div id="6"></div></td>
<td><div id="7"></div></td>
</tr>
</table>

</td><td></td></tr>
<tr><td colspan=3 style="text-align: center;">
<span id="score">Press DOWN to play!</span>
</td></tr>
</table>
</div>
</div>

</body>
</html>